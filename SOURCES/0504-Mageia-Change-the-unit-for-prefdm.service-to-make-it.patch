From 98f76a1d09763bdd774988ffddfe06e32757c724 Mon Sep 17 00:00:00 2001
From: Colin Guthrie <colin@mageia.org>
Date: Fri, 4 Nov 2011 00:28:35 +0000
Subject: [PATCH 504/505] Mageia: Change the unit for prefdm.service to make
 it work a bit more like Fedora

---
 units/mageia/prefdm.service |   14 ++++++++------
 1 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/units/mageia/prefdm.service b/units/mageia/prefdm.service
index 4a896bf..858a61f 100644
--- a/units/mageia/prefdm.service
+++ b/units/mageia/prefdm.service
@@ -8,14 +8,16 @@
 [Unit]
 Description=Display Manager
 After=livesys-late.service rc-local.service systemd-user-sessions.service
-After=network.target acpid.service fs.service haldaemon.service
+After=network-auth.target
 
-# Do not stop plymouth, it is done in prefdm if required
-Conflicts=plymouth-quit.service
-After=plymouth-quit.service
+# On Mageia gdm/X11 is on tty1. We explicitly cancel the getty here to
+# avoid any races around that.
+# Do not stop plymouth, it is done in prefdm if required (or left to the dm)
+Conflicts=getty@tty1.service plymouth-quit.service
+After=getty@tty1.service plymouth-quit.service
 
 [Service]
-ExecStart=/etc/X11/prefdm
-Type=forking
+ExecStart=/etc/X11/prefdm -nodaemon
 Restart=always
 RestartSec=0
+IgnoreSIGPIPE=no
-- 
1.7.9.1

