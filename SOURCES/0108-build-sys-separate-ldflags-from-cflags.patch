From 9b6bee8f2f8cfb140a4f2769c4d416d97b9a3646 Mon Sep 17 00:00:00 2001
From: Lucas De Marchi <lucas.demarchi@profusion.mobi>
Date: Mon, 19 Mar 2012 13:20:43 -0300
Subject: [PATCH 108/115] build-sys: separate ldflags from cflags

---
 Makefile.am  |    1 +
 configure.ac |    7 +++++--
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index 5163ca9..75b2d41 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -107,6 +107,7 @@ AM_CPPFLAGS = \
 	-I $(top_srcdir)/src/systemd
 
 AM_CFLAGS = $(WARNINGFLAGS)
+AM_LDFLAGS = $(GCLDFLAGS)
 
 if TARGET_GENTOO
 AM_CPPFLAGS += \
diff --git a/configure.ac b/configure.ac
index 51e9da3..53c8f0e 100644
--- a/configure.ac
+++ b/configure.ac
@@ -102,10 +102,13 @@ CC_CHECK_FLAGS_APPEND([with_cflags], [CFLAGS], [\
         -fno-strict-aliasing \
         -fvisibility=hidden \
         -ffunction-sections \
-        -fdata-sections \
+        -fdata-sections])
+AC_SUBST([WARNINGFLAGS], $with_cflags)
+
+CC_CHECK_FLAGS_APPEND([with_ldflags], [LDFLAGS], [\
         -Wl,--as-needed \
         -Wl,--gc-sections])
-AC_SUBST([WARNINGFLAGS], $with_cflags)
+AC_SUBST([GCLDFLAGS], $with_ldflags)
 
 LT_PREREQ(2.2)
 LT_INIT
-- 
1.7.9.3

