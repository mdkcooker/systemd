From 2591f38a3e1cc000ebd4afe7ba542c5cb611a323 Mon Sep 17 00:00:00 2001
From: Kay Sievers <kay@vrfy.org>
Date: Fri, 26 Jul 2013 02:33:51 +0200
Subject: [PATCH 108/108] shell-completion: add kernel-install

(cherry picked from commit 819da59577758a7a328020546127091e45bc59e7)
---
 Makefile.am                          |  3 +-
 shell-completion/bash/kernel-install | 68 ++++++++++++++++++++++++++++++++++++
 2 files changed, 70 insertions(+), 1 deletion(-)
 create mode 100644 shell-completion/bash/kernel-install

diff --git a/Makefile.am b/Makefile.am
index 7933de6..20bbc92 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -340,7 +340,8 @@ dist_bashcompletion_DATA = \
 	shell-completion/bash/journalctl \
 	shell-completion/bash/systemctl \
 	shell-completion/bash/systemd-analyze \
-	shell-completion/bash/udevadm
+	shell-completion/bash/udevadm \
+	shell-completion/bash/kernel-install
 
 dist_sysctl_DATA = \
 	sysctl.d/50-default.conf
diff --git a/shell-completion/bash/kernel-install b/shell-completion/bash/kernel-install
new file mode 100644
index 0000000..1832d4a
--- /dev/null
+++ b/shell-completion/bash/kernel-install
@@ -0,0 +1,68 @@
+# kernel-install(8) completion                                   -*- shell-script -*-
+#
+# This file is part of systemd.
+#
+# Copyright 2013 Kay Sievers
+#
+# systemd is free software; you can redistribute it and/or modify it
+# under the terms of the GNU Lesser General Public License as published by
+# the Free Software Foundation; either version 2.1 of the License, or
+# (at your option) any later version.
+#
+# systemd is distributed in the hope that it will be useful, but
+# WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+# General Public License for more details.
+#
+# You should have received a copy of the GNU Lesser General Public License
+# along with systemd; If not, see <http://www.gnu.org/licenses/>.
+
+__contains_word () {
+        local word=$1; shift
+        for w in $*; do [[ $w = $word ]] && return 0; done
+        return 1
+}
+
+_kernel_install() {
+        local i verb comps
+        local cur=${COMP_WORDS[COMP_CWORD]} prev=${COMP_WORDS[COMP_CWORD-1]}
+        local OPTS='-h --help'
+
+        local -A VERBS=(
+                [ADD]='add'
+                [REMOVE]='remove'
+        )
+
+        for ((i=0; $i <= $COMP_CWORD; i++)); do
+                if __contains_word "${COMP_WORDS[i]}" ${VERBS[*]} &&
+                 ! __contains_word "${COMP_WORDS[i-1]}" ${OPTS[ARG]}; then
+                        verb=${COMP_WORDS[i]}
+                        break
+                fi
+        done
+
+        if [[ -z $verb  && $cur = -* ]]; then
+                COMPREPLY=( $(compgen -W '${OPTS[*]}' -- "$cur") )
+                return 0
+        fi
+
+        if [[ -z $verb ]]; then
+                comps=${VERBS[*]}
+
+        elif __contains_word "$verb" ${VERBS[ADD]}; then
+                if [[ $prev = "$verb" ]]; then
+                        comps=$(cd /lib/modules; echo [0-9]*)
+                elif [[ $prev = [0-9]* ]]; then
+                        comps=$(echo /boot/vmlinuz-$prev*)
+                fi
+
+        elif __contains_word "$verb" ${VERBS[REMOVE]}; then
+                comps=$(cd /lib/modules; echo [0-9]*)
+
+        fi
+
+        COMPREPLY=( $(compgen -W '$comps' -- "$cur") )
+        return 0
+}
+
+complete -F _kernel_install kernel-install
-- 
1.8.3.4

