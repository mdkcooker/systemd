From f1ba86ea504fee6ba5a414d9099d21a473d8eef9 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zbigniew=20J=C4=99drzejewski-Szmek?= <zbyszek@in.waw.pl>
Date: Mon, 10 Jun 2013 18:10:12 -0400
Subject: [PATCH 153/160] journald: do not overwrite syslog facility when
 parsing priority

https://bugs.freedesktop.org/show_bug.cgi?id=65610
(cherry picked from commit 49998b38321fca8f431258019e16a9824c643c09)
---
 src/journal/journald-syslog.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/journal/journald-syslog.c b/src/journal/journald-syslog.c
index 000f5ac..4aeb9a3 100644
--- a/src/journal/journald-syslog.c
+++ b/src/journal/journald-syslog.c
@@ -268,7 +268,7 @@ void syslog_parse_priority(char **p, int *priority) {
         if (a < 0 || b < 0 || c < 0)
                 return;
 
-        *priority = a*100+b*10+c;
+        *priority = (*priority & LOG_FACMASK) | (a*100 + b*10 + c);
         *p += k;
 }
 
-- 
1.8.3.1

