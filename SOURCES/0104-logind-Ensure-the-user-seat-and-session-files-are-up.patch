From ad9df9044ffa278884af9b96f29726dd21333a87 Mon Sep 17 00:00:00 2001
From: Colin Guthrie <colin@mageia.org>
Date: Tue, 4 Sep 2012 01:28:40 +0100
Subject: [PATCH 104/105] logind: Ensure the user, seat and session files are
 updated when the session is closing.

---
 src/login/logind-session.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/login/logind-session.c b/src/login/logind-session.c
index 16d4955..6733020 100644
--- a/src/login/logind-session.c
+++ b/src/login/logind-session.c
@@ -702,9 +702,11 @@ int session_stop(Session *s) {
                         seat_set_active(s->seat, NULL);
 
                 seat_send_changed(s->seat, "Sessions\0");
+                seat_save(s->seat);
         }
 
         user_send_changed(s->user, "Sessions\0");
+        user_save(s->user);
 
         s->started = false;
 
@@ -858,6 +860,9 @@ void session_remove_fifo(Session *s) {
                 assert_se(epoll_ctl(s->manager->epoll_fd, EPOLL_CTL_DEL, s->fifo_fd, NULL) == 0);
                 close_nointr_nofail(s->fifo_fd);
                 s->fifo_fd = -1;
+
+                session_save(s);
+                user_save(s->user);
         }
 
         if (s->fifo_path) {
-- 
1.7.12

