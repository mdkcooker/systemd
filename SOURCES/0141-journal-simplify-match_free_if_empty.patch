From 70977315cad5b01f48b0915001eb3d40e88d6dff Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zbigniew=20J=C4=99drzejewski-Szmek?= <zbyszek@in.waw.pl>
Date: Sun, 2 Jun 2013 15:00:00 -0400
Subject: [PATCH 141/160] journal: simplify match_free_if_empty

(cherry picked from commit c5a10d9ca017be6133154e09383c84c3d5b85f7c)
---
 src/journal/sd-journal.c | 19 +++++--------------
 1 file changed, 5 insertions(+), 14 deletions(-)

diff --git a/src/journal/sd-journal.c b/src/journal/sd-journal.c
index cf60ebc..2bad243 100644
--- a/src/journal/sd-journal.c
+++ b/src/journal/sd-journal.c
@@ -197,9 +197,7 @@ static void match_free(Match *m) {
 }
 
 static void match_free_if_empty(Match *m) {
-        assert(m);
-
-        if (m->matches)
+        if (!m || m->matches)
                 return;
 
         match_free(m);
@@ -296,17 +294,10 @@ _public_ int sd_journal_add_match(sd_journal *j, const void *data, size_t size)
         return 0;
 
 fail:
-        if (add_here)
-                match_free_if_empty(add_here);
-
-        if (j->level2)
-                match_free_if_empty(j->level2);
-
-        if (j->level1)
-                match_free_if_empty(j->level1);
-
-        if (j->level0)
-                match_free_if_empty(j->level0);
+        match_free_if_empty(add_here);
+        match_free_if_empty(j->level2);
+        match_free_if_empty(j->level1);
+        match_free_if_empty(j->level0);
 
         return -ENOMEM;
 }
-- 
1.8.3.1

