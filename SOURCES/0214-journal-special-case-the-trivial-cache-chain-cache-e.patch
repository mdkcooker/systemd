From 0b189ee1f776744c1910a9ffe2b79a665084dc97 Mon Sep 17 00:00:00 2001
From: Lennart Poettering <lennart@poettering.net>
Date: Fri, 26 Oct 2012 20:25:36 +0200
Subject: [PATCH 214/214] journal: special case the trivial cache chain cache
 entry (cherry picked from commit 34741aa3e2ee1e67a4cc735b7492aec13f0d822c)

---
 src/journal/journal-file.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/journal/journal-file.c b/src/journal/journal-file.c
index 6c9deac..3df099d 100644
--- a/src/journal/journal-file.c
+++ b/src/journal/journal-file.c
@@ -1328,6 +1328,11 @@ static void chain_cache_put(
                 uint64_t total) {
 
         if (!ci) {
+                /* If the chain item to cache for this chain is the
+                 * first one it's not worth caching anything */
+                if (array == first)
+                        return;
+
                 if (hashmap_size(h) >= CHAIN_CACHE_MAX)
                         ci = hashmap_steal_first(h);
                 else {
-- 
1.8.1.5

